<style>
  .nexantFormWrap {
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
    background: #fcfeff !important;
    padding: 15px;
  }

  #nexantFormWrap {
    width: 1100px;
    height: 100%;
    overflow: auto;
    margin: auto;
  }

  .nexantFormWrap #formModule {
    width: 100%;
  }

  .divBoxStyle {
    width: 100%;
    display: flex;
    border-bottom: 1px solid #d2d2d2;
    background: #EEEEEE;
  }

  .divTitle {
    width: 40px;
    writing-mode: tb-rl;
    -webkit-writing-mode: vertical-rl;
    color: #ffffff;
    text-align: center;
    font-size: 20px;
    font-weight: 600;
  }

  .divTable {
    width: calc(100% - 40px);
    color: #d2d2d2
  }

  [data-module="baseline"] .divTitle {
    background: #0074ce;
  }

  .divSubTitle {
    padding: 6px 12px;
    color: #ffffff;
    border-left: 1px solid #d2d2d2;
    border-bottom: 1px solid #d2d2d2;
    border-right: 1px solid #d2d2d2;
  }

  [data-module="baseline"] .divSubTitle {
    background: #0074ce;
  }

  .divTableHeader {
    display: flex;
    background: #0074ce;
    color: #ffffff;
  }

  [data-module="upgrade"] .divTitle,
  [data-module="upgrade"] .divSubTitle,
  [data-module="upgrade"] .divTableHeader {
    background: #fb9e4c;
  }

  .divTableHeader div,
  .divTableRow div {
    padding: 6px 12px;
    border-left: 1px solid #d2d2d2;
    border-bottom: 1px solid #d2d2d2;
  }

  #formModule .divTableHeader div:first-child,
  #formModule .divTableHeader div:last-child,
  #formModule .divTableRow div:first-child,
  #formModule .divTableRow div:last-child {
    width: calc(50% - 15px);
  }

  #formModule .divTableRow div:last-child,
  #formModule .divTableHeader div:last-child {
    border-right: 1px solid #d2d2d2;
  }

  #formModule .divTableRow div:last-child {
    display: flex;
  }

  #formModule .divTableRow div:nth-child(2),
  #formModule .divTableHeader div:nth-child(2) {
    width: 30px;
    text-align: center;
    padding: 5px;
  }

  #formModule .divTableRow div:last-child {
    padding: 3px;
  }

  .divTableRow .iconfont {
    color: #fb9e4c;
  }

  .nexantFormWrap .iptStyle {
    background: #fff;
    padding: 1px 6px;
    border-right: none;
    color: #0e2133;
    width: 100%;
    display: block;
    height: 100%;
    border-top: 2px solid #a5a5a5;
    border-left: 2px solid #a5a5a5;
  }

  .nexantFormWrap .selectStyle {
    width: 100%;
    padding-left: 3px;
    border-right: none;
    border-bottom: none;
    border-top: 2px solid #a5a5a5;
    border-left: 2px solid #a5a5a5;
  }



  .divTableRow {
    height: 30px;
    display: flex;
    color: #1b2e40;
  }

  .divTableRow input {
    width: 100%;
  }

  .trMerge .divTableRow div:first-child {
    border-bottom: none;
  }

  .divSpanWrap p {
    color: #0074ce;
    padding: 5px;
  }

  .divSpanWrap span {
    width: 25%;
    border-right: 1px solid #d2d2d2;
    margin-top: -3px;
    margin-bottom: -3px;
    padding: 3px;
    white-space: nowrap;
  }

  .divSpanWrap span:first-child {
    padding-left: 0;
  }

  .divSpanWrap span:nth-child(2) {
    text-align: center;
    width: 15%;
  }

  .divSpanWrap span:last-child {
    width: 35%;
  }

  .divSpanWrap span:last-child {
    border-right: none;
  }

  .btnSubmitStyle {
    margin-top: 50px;
  }

  .btnSubmitStyle button {
    display: block;
    margin: auto;
    width: 320px;
    height: 46px;
    object-fit: contain;
    border: solid 1px #d2d2d2;
    background-color: #e5e5e5;
    color: #0074ce;
    font-size: 18px;
    font-weight: 600;
  }

  .nexantFormWrap .short {
    width: 20%;
    padding-right: 3px;
  }

  .nexantFormWrap .middle {
    width: 60%;
  }

  .nexantFormWrap .long {
    width: 80%;
  }

  .divSpanWrap span.short {
    width: 20%;
    padding-right: 3px;
  }

  .divSpanWrap span.middle {
    width: 60%;
    padding-right: 0;
  }

  .divSpanWrap span.long {
    width: 80%;
  }

  .thirdLevelTitle {
    line-height: 23px;
  }

  .thirdLevelTitle span:nth-child(2) {
    text-align: left;
  }

  /* 提交后展示部分 */

  .formResultWrap {
    width: 100%;
    margin-top: 50px;
    background: #EEEEEE;
  }

  .formResultWrap .divSubTitle {
    background: #77BC1F;
  }

  .formResultWrap .divTableRow div:first-child {
    width: 75%;
  }

  .formResultWrap .divTableRow div:last-child {
    width: 25%;
    padding: 3px;
  }

  .formResultWrap .divTableRow div:last-child {
    border-right: 1px solid #d2d2d2;
  }

  .formResultWrap .iptStyle {
    color: #e37a00;
    font-size: 14px;
    font-weight: 600;
    text-align: right;
  }

  [result-module="four"] {
    margin-top: 50px;
    border-top: 1px solid #d2d2d2;
  }
</style>
<div class="nexantFormWrap">
  <div id="nexantFormWrap">
    <div id="formModule">
      <div class="divBoxStyle" data-module="baseline">
        <div class="divTitle">BaseLine</div>
        <div class="divTable">
          <div class="divSubTitle">BASELINE PARAMETERS AND OPERATION</div>
          <div class="divTableHeader">
            <div>Air Handler Specifications</div>
            <div>DF</div>
            <div>Inputs & Notes</div>
          </div>

          <div class="divTableRow">
            <div>AHU Name</div>
            <div></div>
            <div>
              <input type="text" class="iptStyle" data-name="ahu_name">
            </div>
          </div>

          <div class="divTableRow">
            <div>AHU Type</div>
            <div>
              <span class="iconfont icon-cuowu" data-icon="ahu_type"></span>
            </div>
            <div>
              <span class="short">
                <select name="" id="" class="selectStyle" data-name="ahu_type">
                  <option value="VAV">VAV</option>
                  <option value="CAV">CAV</option>
                </select>
              </span>
              <span class="long">
                <input type="text" class="iptStyle">
              </span>
            </div>
          </div>
          <div class="divTableRow">
            <div>Total Fan Horsepower (hp)</div>
            <div></div>
            <div>
              <span class="short">
                <input type="text" class="iptStyle" data-name="hp">
              </span>
              <span class="long">
                <input type="text" class="iptStyle">
              </span>
            </div>
          </div>
          <div class="divTableRow">
            <div>Design Flow (CFM)</div>
            <div></div>
            <div>
              <span class="short">
                <input type="text" class="iptStyle" data-name="design_flow">
              </span>
              <span class="long">
                <input type="text" class="iptStyle">
              </span>
            </div>
          </div>
          <div class="divTableRow">
            <div>Fan Static Efficiency</div>
            <div>
              <span class="iconfont icon-cuowu" data-icon="fan_static_eff"></span>
            </div>
            <div>
              <span class="short">
                <input type="text" class="iptStyle" data-name="fan_static_eff" value="60">
              </span>
              <span class="long">
                <input type="text" class="iptStyle">
              </span>
            </div>
          </div>
          <div class="divTableRow">
            <div>Fan Type</div>
            <div>
              <span class="iconfont icon-cuowu" data-icon="fan_type"></span>
            </div>
            <div>
              <select name="" id="" class="selectStyle" data-name="fan_type">
                <option value="6">Variable-Speed Drive</option>
                <option value="1">Air-Foil or Backward-Inclined - Dampers Control Flow</option>
                <option value="2">Air-Foil or Backward-Inclined - Inlet Vanes</option>
                <option value="3">Forward-Curved - Dampers Control Flow</option>
                <option value="4">Forward-Curved - Inlet Vanes</option>
                <option value="5">Vane-Axial - Variable Pitch Blades</option>
              </select>
            </div>
          </div>

          <div class="trMerge" data-param="air_flow_param">
            <div class="divTableRow">
              <div>Air Flow Parameters</div>
              <div></div>
              <div class="divSpanWrap thirdLevelTitle">
                <span>Flow (%)</span>
                <span></span>
                <span>OAT (°F)</span>
                <span></span>
              </div>
            </div>

            <div class="divTableRow paramRow">
              <div></div>
              <div>
                <span class="iconfont icon-cuowu"></span>
              </div>
              <div class="divSpanWrap">
                <span>
                  <input type="text" class="iptStyle" data-name="flow">
                </span>
                <span>@</span>
                <span>
                  <input type="text" class="iptStyle" data-name="oat">
                </span>
                <span>and higher</span>
              </div>
            </div>

            <div class="divTableRow paramRow">
              <div></div>
              <div>
                <span class="iconfont icon-cuowu"></span>
              </div>
              <div class="divSpanWrap">
                <span>
                  <input type="text" class="iptStyle" data-name="flow">
                </span>
                <span>@</span>
                <span>
                  <input type="text" class="iptStyle" data-name="oat">
                </span>
                <span></span>
              </div>
            </div>

            <div class="divTableRow paramRow">
              <div></div>
              <div>
                <span class="iconfont icon-cuowu"></span>
              </div>
              <div class="divSpanWrap">
                <span>
                  <input type="text" class="iptStyle" data-name="flow">
                </span>
                <span>@</span>
                <span>
                  <input type="text" class="iptStyle" data-name="oat">
                </span>
                <span>and lower</span>
              </div>
            </div>
            <div class="divTableRow">
              <div></div>
              <div></div>
              <div class="divSpanWrap">
                <p>With a linear variation between the indicated points</p>
              </div>
            </div>
          </div>

          <div class="divSubTitle">Static Pressure Setpoint</div>
          <div class="trMerge" data-param="base_static_p_sp_param">
            <div class="divTableRow">
              <div>Static Pressure Setpoint Parameters</div>
              <div></div>
              <div class="divSpanWrap thirdLevelTitle">
                <span>Static P(in.w.c.)</span>
                <span></span>
                <span>OAT (°F)</span>
                <span></span>
              </div>
            </div>

            <div class="divTableRow">
              <div></div>
              <div></div>
              <div class="divSpanWrap paramRow">
                <span>
                  <input type="text" class="iptStyle" data-name="flow">
                </span>
                <span>@</span>
                <span>
                  <input type="text" class="iptStyle" data-name="oat">
                </span>
                <span>and higher</span>
              </div>
            </div>

            <div class="divTableRow paramRow">
              <div></div>
              <div></div>
              <div class="divSpanWrap">
                <span>
                  <input type="text" class="iptStyle" data-name="flow">
                </span>
                <span>@</span>
                <span>
                  <input type="text" class="iptStyle" data-name="oat">
                </span>
                <span></span>
              </div>
            </div>

            <div class="divTableRow paramRow">
              <div></div>
              <div></div>
              <div class="divSpanWrap">
                <span>
                  <input type="text" class="iptStyle" data-name="flow">
                </span>
                <span>@</span>
                <span>
                  <input type="text" class="iptStyle" data-name="oat">
                </span>
                <span>and lower</span>
              </div>
            </div>

            <div class="divTableRow">
              <div></div>
              <div></div>
              <div class="divSpanWrap">
                <p>With a linear variation between the indicated points</p>
              </div>
            </div>
          </div>

          <div class="divSubTitle">Unoccupied Parameters</div>
          <div class="divTableRow">
            <div>Is the AHU allowed to cycle during unoccupied hours?</div>
            <div></div>
            <div>
              <select name="" id="" class="selectStyle short" data-name="ahu_cycle_during_unocc_hours">
                <option value="1">Yes</option>
                <option value="0">No</option>
              </select>
            </div>
          </div>
          <div class="divTableRow">
            <div>Unoccupied Cycling Factor</div>
            <div>
              <span class="iconfont icon-cuowu" data-icon="ahu_cycle_during_unocc_hours"></span>
            </div>
            <div>
              <input type="text" class="iptStyle short" data-name="unocc_cycling_factor" value="30">
            </div>
          </div>

          <div class="divSubTitle">Air Handler Schedule</div>
          <div class="divTableRow">
            <div>Day</div>
            <div></div>
            <div class="divSpanWrap thirdLevelTitle">
              <span class="short">Time On</span>
              <span class="short">Time Off</span>
              <span class="middle">Notes</span>
            </div>
          </div>

          <div class="divTableRow dateRow">
            <div>Mon</div>
            <div></div>
            <div class="divSpanWrap">
              <span class="short">
                <input type="text" class="iptStyle" value="0">
              </span>
              <span class="short">
                <input type="text" class="iptStyle" value="23">
              </span>
              <span class="middle">
                <input type="text" class="iptStyle">
              </span>
            </div>
          </div>

          <div class="divTableRow dateRow">
            <div>Tues</div>
            <div></div>
            <div class="divSpanWrap">
              <span class="short">
                <input type="text" class="iptStyle" value="0">
              </span>
              <span class="short">
                <input type="text" class="iptStyle" value="23">
              </span>
              <span class="middle">
                <input type="text" class="iptStyle">
              </span>
            </div>
          </div>

          <div class="divTableRow dateRow">
            <div>Wed</div>
            <div></div>
            <div class="divSpanWrap">
              <span class="short">
                <input type="text" class="iptStyle" value="0">
              </span>
              <span class="short">
                <input type="text" class="iptStyle" value="23">
              </span>
              <span class="middle">
                <input type="text" class="iptStyle">
              </span>
            </div>
          </div>
          <div class="divTableRow dateRow">
            <div>Thur</div>
            <div></div>
            <div class="divSpanWrap">
              <span class="short">
                <input type="text" class="iptStyle" value="0">
              </span>
              <span class="short">
                <input type="text" class="iptStyle" value="23">
              </span>
              <span class="middle">
                <input type="text" class="iptStyle">
              </span>
            </div>
          </div>
          <div class="divTableRow dateRow">
            <div>Fri</div>
            <div></div>
            <div class="divSpanWrap">
              <span class="short">
                <input type="text" class="iptStyle" value="0">
              </span>
              <span class="short">
                <input type="text" class="iptStyle" value="23">
              </span>
              <span class="middle">
                <input type="text" class="iptStyle">
              </span>
            </div>
          </div>
          <div class="divTableRow dateRow">
            <div>Sat</div>
            <div></div>
            <div class="divSpanWrap">
              <span class="short">
                <input type="text" class="iptStyle" value="0">
              </span>
              <span class="short">
                <input type="text" class="iptStyle" value="23">
              </span>
              <span class="middle">
                <input type="text" class="iptStyle">
              </span>
            </div>
          </div>
          <div class="divTableRow dateRow">
            <div>Sun</div>
            <div></div>
            <div class="divSpanWrap">
              <span class="short">
                <input type="text" class="iptStyle" value="0">
              </span>
              <span class="short">
                <input type="text" class="iptStyle" value="23">
              </span>
              <span class="middle">
                <input type="text" class="iptStyle">
              </span>
            </div>
          </div>
        </div>
      </div>
      <div class="divBoxStyle" data-module="upgrade">
        <div class="divTitle">Upgrade</div>
        <div class="divTable">
          <div class="divSubTitle">UPGRADE PARAMETERS</div>
          <div class="divTableHeader">
            <div>Static Pressure Setpoint</div>
            <div></div>
            <div></div>
          </div>
          <div class="trMerge" data-param="upgrade_static_p_sp_param">
            <div class="divTableRow">
              <div>Static Pressure Setpoint Parameters</div>
              <div></div>
              <div class="divSpanWrap thirdLevelTitle">
                <span>Static P (in. w.c.)</span>
                <span></span>
                <span>OAT (°F)</span>
                <span></span>
              </div>
            </div>

            <div class="divTableRow paramRow">
              <div></div>
              <div></div>
              <div class="divSpanWrap">
                <span>
                  <input type="text" class="iptStyle" data-name="flow">
                </span>
                <span>@</span>
                <span>
                  <input type="text" class="iptStyle" data-name="oat">
                </span>
                <span>and higher</span>
              </div>
            </div>

            <div class="divTableRow paramRow">
              <div></div>
              <div></div>
              <div class="divSpanWrap">
                <span>
                  <input type="text" class="iptStyle" data-name="flow">
                </span>
                <span>@</span>
                <span>
                  <input type="text" class="iptStyle" data-name="oat">
                </span>
                <span></span>
              </div>
            </div>

            <div class="divTableRow paramRow">
              <div></div>
              <div></div>
              <div class="divSpanWrap">
                <span>
                  <input type="text" class="iptStyle" data-name="flow">
                </span>
                <span>@</span>
                <span>
                  <input type="text" class="iptStyle" data-name="oat">
                </span>
                <span>and lower</span>
              </div>
            </div>
            <div class="divTableRow">
              <div></div>
              <div></div>
              <div class="divSpanWrap">
                <p>With a linear variation between the indicated points</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="btnSubmitStyle">
        <button type="submit">Submit</button>
      </div>
    </div>
    <div class="formResultWrap">
      <div class="resultBox">
        <div result-module="one">
          <div class="divSubTitle">Savings Summary</div>
          <div class="divTableBody">
            <div class="divTableRow">
              <div>Annual Electric Use Reduction (kWh/yr)</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="annual_elect_reduction"></span>
                </span>
              </div>
            </div>
            <div class="divTableRow">
              <div>Peak Demand Reduction (kW)</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="peak_demand_reduction"></span>
                </span>
              </div>
            </div>
            <div class="divTableRow">
              <div>Annual Electric Cost Reduction ($/yr)</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="annual_elec_cost_reduction"></span>
                </span>
              </div>
            </div>
            <div class="divTableRow">
              <div>Annual Gas Use Reduction (therm/yr)</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="annual_gas_reduction"></span>
                </span>
              </div>
            </div>
            <div class="divTableRow">
              <div>Annual Gas Cost Reduction ($/yr)</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="annual_gas_cost_reduction"></span>
                </span>
              </div>
            </div>
            <div class="divTableRow">
              <div>Total Annual Cost Reduction ($/yr)</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="annual_cost_reduction"></span>
                </span>
              </div>
            </div>
            <div class="divTableRow">
              <div>Estimated Project Cost ($)</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="estimated_project_cost"></span>
                </span>
              </div>
            </div>
            <div class="divTableRow">
              <div>Simple Payback (yr) </div>
              <div>
                <span>
                  <span class="iptStyle" data-key="simple_payback"></span>
                </span>
              </div>
            </div>
            <div class="divTableRow">
              <div>Simple Payback - Electric Only (yr)</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="elec_simple_payback"></span>
                </span>
              </div>
            </div>
          </div>
        </div>

        <div result-module="two">
          <div class="divSubTitle">Utility Peak</div>
          <div class="divTableBody">
            <div class="divTableRow">
              <div>Utility Peak Demand Reduction (kW)</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="utility_peak_demand_reduction"></span>
                </span>
              </div>
            </div>
          </div>
        </div>

        <div result-module="three">
          <div class="divSubTitle">Feasibility Check</div>
          <div class="divTableBody">
            <div class="divTableRow">
              <div>Calculated Baseline (kWh/yr)</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="annual_elec_base"></span>
                </span>
              </div>
            </div>
            <div class="divTableRow">
              <div>Calculated Baseline - Percent of Annual Usage</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="base_percent_of_annual_use"></span>
                </span>
              </div>
            </div>
            <div class="divTableRow">
              <div>Typical Baseline - Percent of Annual Usage</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="typical_base_percent_of_annual_use"></span>
                </span>
              </div>
            </div>
            <div class="divTableRow">
              <div>Project Savings - Percent of Baseline</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="reduction_percent_of_elec_base"></span>
                </span>
              </div>
            </div>
            <div class="divTableRow">
              <div>Project Savings - Percent of Annual Usage</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="reduction_percent_of_elec_use"></span>
                </span>
              </div>
            </div>
          </div>
        </div>

        <div result-module="four">
          <div class="divTableBody">
            <div class="divTableRow">
              <div>Summer Peak Demand Reduction (kW)</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="peak_demand_reduction_in_summer"></span>
                </span>
              </div>
            </div>
            <div class="divTableRow">
              <div>Winter Peak Demand Reduction (kW)</div>
              <div>
                <span>
                  <span class="iptStyle" data-key="peak_demand_reduction_in_winter"></span>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  class NexantForm {
    constructor() {

    }
    show() {
      this.init();
    }
    init() {
      //this.renderFormData();
      this.initStaticParam("VAV")
      this.attachEvent();
    }
    attachEvent() {
      let container = $("#formModule");
      $("[data-name=ahu_type]", container).on("change", (e) => {
        let iconTarget = $("[data-icon=ahu_type]", container);
        if (e.currentTarget.value == "VAV") {
          iconTarget.css("display", "block")
        } else {
          iconTarget.css("display", "none");
        }
        this.initStaticParam(e.currentTarget.value);
      })
      $("[data-name=fan_type]", container).on("change", (e) => {
        let iconTarget = $("[data-icon=fan_type]", container);
        if (e.currentTarget.value == "6") {
          iconTarget.css("display", "block")
        } else {
          iconTarget.css("display", "none");
        }
      })
      $("[data-name=ahu_cycle_during_unocc_hours]", container).on("change", (e) => {
        let iconTarget = $("[data-icon=ahu_cycle_during_unocc_hours]", container);
        let targetValue = $("[data-name=unocc_cycling_factor]", container)
        if (e.currentTarget.value == "1") {
          iconTarget.css("display", "block");
          targetValue.val(30);
        } else {
          iconTarget.css("display", "none");
          targetValue.val(0);
        }
      });
      $("[data-name=unocc_cycling_factor]", container).on("change", (e) => {
        let iconTarget = $("[data-icon=ahu_cycle_during_unocc_hours]", container);
        let targetValue = $("[data-name=ahu_cycle_during_unocc_hours]", container)
        if (targetValue.val() == "1" && e.currentTarget.value == "30") {
          iconTarget.css("display", "block");
        } else {
          iconTarget.css("display", "none");
        }
      })
      $("[data-name=fan_static_eff]", container).on("change", (e) => {
        let iconTarget = $("[data-icon=fan_static_eff]", container);
        if (e.currentTarget.value == "60") {
          iconTarget.css("display", "block")
        } else {
          iconTarget.css("display", "none");
        }
      })
      $(".btnSubmitStyle button").on("click", () => {
        let payload = {
          "ahu_name": "",
          "ahu_type": "",
          "hp": 0,
          "design_flow": 0,
          "fan_static_eff": 0,
          "fan_type": "",
          "air_flow_param": this.getStaticParam("air_flow_param"),
          "base_static_p_sp_param": this.getStaticParam("base_static_p_sp_param"),
          "upgrade_static_p_sp_param": this.getStaticParam("upgrade_static_p_sp_param"),
          "ahu_cycle_during_unocc_hours": 0,
          "unocc_cycling_factor": 0,
          "ahu_schedule": this.getStaticDate(),
        };
        let valueToString = ["ahu_name", "ahu_type", "fan_type", "unocc_cycling_factor"]
        Object.keys(payload).forEach(item => {
          if ($(`[data-name="${item}"]`, container).length > 0) {
            let value = $(`[data-name="${item}"]`).val();
            if (valueToString.indexOf(item) == -1) value = Number(value);
            if (item == "fan_static_eff") value = value / 100;
            payload[item] = value;
          }
        });
        Spinner.spin($(".nexantFormWrap")[0]);
        WebAPI.post('/airflow/runNotebook/900/5d15896eff12b453d5a5f884', payload).done(rs => {
          Spinner.stop();
          if (!rs.data || rs.data.length == 0) {
            alert("No data");
            return;
          }
          let resultData = {};
          try {
            resultData = JSON.parse(rs.data[0].data["text/plain"].replace(/'/g, '"'));
          } catch (err) {
            console.log(err);
          }
          this.renderFormData(resultData)
        }).always(() => {
          Spinner.stop();
        })
      })
    }
    initStaticParam(model) {
      let initData = {
        "VAV": [{
          "oat": 90,
          "flow": 90
        }, {
          "oat": 55,
          "flow": 50
        }, {
          "oat": 5,
          "flow": 50
        }],
        "CAV": [{
          "oat": 95,
          "flow": 100
        }, {
          "oat": 55,
          "flow": 100
        }, {
          "oat": 5,
          "flow": 100
        }],
      }
      let paramArray = Array.from($(`[data-param="air_flow_param"]`).find(".paramRow"));
      let modelArray = initData[model];
      paramArray.forEach((item, i) => {
        $(item).find(".iconfont").css("display", "block");
        $(item).find(`[data-name="oat"]`).val(modelArray[i].oat).on("change", (e) => {
          if (e.currentTarget.value == modelArray[i].oat) {
            $(item).find(".iconfont").css("display", "block")
          } else {
            $(item).find(".iconfont").css("display", "none");
          }
        });
        $(item).find(`[data-name="flow"]`).val(modelArray[i].flow).on("change", (e) => {
          if (e.currentTarget.value == modelArray[i].flow) {
            $(item).find(".iconfont").css("display", "block")
          } else {
            $(item).find(".iconfont").css("display", "none");
          }
        });;
      })
    }
    getStaticParam(name) {
      let paramArray = Array.from($(`[data-param="${name}"]`).find(".paramRow"));
      let array = [];
      if (name == "air_flow_param") {
        paramArray.forEach(item => {
          array.push({
            "oat": Number($(item).find(`[data-name="oat"]`).val()),
            "flow": Number($(item).find(`[data-name="flow"]`).val()) / 100
          })
        });
      } else {
        paramArray.forEach(item => {
          array.push({
            "oat": Number($(item).find(`[data-name="oat"]`).val()),
            "value": Number($(item).find(`[data-name="flow"]`).val())
          })
        });
      }

      return array;
    }
    getStaticDate() {
      let dateArray = Array.from($(".dateRow"));
      let schedule = {}
      dateArray.forEach(item => {
        let key = $(item.firstElementChild).text().toLowerCase();
        let inputArray = $("input", item);
        schedule[key] = {
          "on": Number(inputArray[0].value),
          "off": Number(inputArray[1].value),
          "notes": Number(inputArray[2].value)
        }
      })
      return schedule
    }
    renderFormData(rsData) {
      let percentKey = ["base_percent_of_annual_use", "reduction_percent_of_elec_base",
        "reduction_percent_of_elec_use"
      ];
      //保留小数位
      let savePoinit = {
        "annual_elect_reduction": 0,
        "peak_demand_reduction": 2,
        "annual_elec_cost_reduction": 0,
        "annual_gas_reduction": 1,
        "annual_gas_cost_reduction": 0,
        "annual_cost_reduction": 0,
        "estimated_project_cost": 0,
        "simple_payback": 1,
        "elec_simple_payback": 1,
        "utility_peak_demand_reduction": 1,
        "annual_elec_base": 0,
        "base_percent_of_annual_use": 0,
        "reduction_percent_of_elec_base": 0,
        "reduction_percent_of_elec_use": 1,
        "peak_demand_reduction_in_summer": 2,
        "peak_demand_reduction_in_winter": 2
      }
      rsData["typical_base_percent_of_annual_use"] = rsData["typical_base_percent_of_annual_use"] ? rsData[
        "typical_base_percent_of_annual_use"].replace(/.0/g, '') : "";
      Object.keys(rsData).forEach(item => {
        let value = rsData[item];
        if (percentKey.indexOf(item) > -1) {
          value = this.getThousandsBit(value * 100, savePoinit[item]) + '%';
        } else {
          if (Number(value) || Number(value) ===0) value = this.getThousandsBit(value, savePoinit[item])
        }
        $(`[data-key="${item}"]`).text(value);
      })

    }
    getThousandsBit(num, p) {
      num = num.toFixed(p);
      let str = (num).split(".")[0];
      let point = (num).split(".")[1];
      str = str.split("").reverse().reduce((prev, next, index) => {
        return ((index % 3) ? next : (next + ',')) + prev;
      })
      if (p) {
        if(!point) point="00";
        str += "." + point.slice(0, p);
      }
      return str;
    }
  }
  new NexantForm().show()
</script>